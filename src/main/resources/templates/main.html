<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

    <title>ITA</title>
    <link type="text/css" rel="stylesheet" th:href="@{/vendor/css/bootstrap.min.css}"/>
    <link type="text/css" rel="stylesheet" th:href="@{/vendor/css/bootstrap-vue.min.css}"/>

    <script src="//polyfill.io/v3/polyfill.js?features=es2015%2CIntersectionObserver" crossorigin="anonymous"></script>

    <script th:src="@{/vendor/js/vue.min.js}"></script>
    <script th:src="@{/vendor/js/bootstrap-vue.min.js}"></script>

    <script th:src="@{/vendor/js/bootstrap-vue-icons.min.js}"></script>
    <script th:src="@{/vendor/js/axios.min.js}"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const CONTEXT_PATH = [[${#request.getContextPath()}]];
        /*]]>*/
    </script>
</head>
<body>
<div id="ita">
    <b-container fluid>
        <div>
            <b-navbar toggleable="lg" type="dark" variant="secondary" fixed="top" sticky="true">
                <b-navbar-brand th:href="@{/main}">
                    <b-icon icon="stoplights"></b-icon>
                    ITA
                </b-navbar-brand>

                <b-navbar-toggle target="nav-collapse"></b-navbar-toggle>

                <b-collapse id="nav-collapse" is-nav>
                    <!--<b-navbar-nav>
                        <b-nav-item href="#">메뉴</b-nav-item>
                    </b-navbar-nav>-->

                    <b-navbar-nav class="ml-auto">
                        <b-nav-form>
                            <b-form-input size="sm" class="mr-sm-2 inp-search-client-id" placeholder="Search" v-model="searchForm.clientId" th:data-client_id="${cleintId}"></b-form-input>
                            <b-button size="sm" class="my-2 my-sm-0" type="button" @click="searchAll">
                                <b-icon icon="search"></b-icon>
                                Search
                            </b-button>
                        </b-nav-form>

                        <b-nav-item-dropdown right>
                            <template #button-content>
                                <b-button size="sm" class="my-2 my-sm-0">
                                    <b-icon icon="person-circle"></b-icon>
                                    <span th:text="${user.getUserName()+'['+user.getTeamName()+']'}"></span></b-button>
                            </template>
                            <b-dropdown-item th:href="@{/sign-out}">
                                <b-icon icon="person"></b-icon>
                                Sign Out
                            </b-dropdown-item>
                        </b-nav-item-dropdown>
                    </b-navbar-nav>
                </b-collapse>
            </b-navbar>
        </div>
        <hr>
        <b-row>
            <b-col cols="12">
                <div>
                    <b-card no-body>
                        <b-tabs fill active-nav-item-class="font-weight-bold text-uppercase text-danger" content-class="mt-3">
                            <b-tab active>
                                <template #title>
                                    <b-icon icon="app"></b-icon>
                                    APP
                                    <b-badge pill variant="info">{{appsCount}}</b-badge>
                                </template>
                                <div th:align="right">
                                    <b-button v-b-modal.modal-manage-app pill variant="outline-secondary" size="sm" @click="createAppModalInit">APP 추가</b-button>
                                </div>

                                <b-table
                                        striped
                                        hover
                                        show-empty
                                        :items="app.list.items"
                                        :fields="app.list.fields"
                                >
                                    <template #cell(actions)="row">
                                        <b-button size="sm" @click="setAppValue(row.item, row.index, $event.target)" class="mr-1">
                                            수정
                                        </b-button>
                                        <b-button size="sm" @click="row.toggleDetails">
                                            {{ row.detailsShowing ? '*' : '' }} 정보 조회
                                        </b-button>
                                        <b-button size="sm" @click="deleteApp( row.index )" variant="outline-danger">
                                            삭제
                                        </b-button>
                                    </template>

                                    <template #row-details="row">
                                        <b-card>
                                            <b-row>
                                                <b-col>
                                                    <b-icon icon="app"></b-icon> <b>App 정보</b>
                                                    <ul>
                                                        <li v-for="(value, key) in row.item" :key="key">{{ key }}: {{ value }}</li>
                                                    </ul>
                                                </b-col>
                                                <b-col>
                                                    <b-icon icon="app"></b-icon> <b>개발자센터 입력정보</b>
                                                    <b-list-group style="max-width: 700px;">
                                                        <b-list-group-item class="d-flex align-items-center">
                                                            <b style="min-width: 100px;">app url</b>
                                                            <span class="mr-auto common-url">{{window.location.protocol }}//{{window.location.hostname }}{{CONTEXT_PATH}}/auth/{{ row.item.idx }}</span>
                                                            <b-button size="sm" variant="outline-secondary" @click="copyUrl">copy</b-button>
                                                        </b-list-group-item>
                                                        <b-list-group-item class="d-flex align-items-center">
                                                            <b style="min-width: 100px;">redirect url</b>
                                                            <span class="mr-auto common-url">{{window.location.protocol }}//{{window.location.hostname }}{{CONTEXT_PATH}}/auth/{{ row.item.idx }}/redirect</span>
                                                            <b-button size="sm" variant="outline-secondary" @click="copyUrl">copy</b-button>
                                                        </b-list-group-item>
                                                        <b-list-group-item class="d-flex align-items-center">
                                                            <b style="min-width: 100px;">webhook url</b>
                                                            <span class="mr-auto common-url">{{window.location.protocol }}//{{window.location.hostname }}{{CONTEXT_PATH}}/api/v1/webhooks/{{ row.item.idx }}</span>
                                                            <b-button size="sm" variant="outline-secondary" @click="copyUrl">copy</b-button>
                                                        </b-list-group-item>
                                                    </b-list-group>
                                                </b-col>
                                            </b-row>
                                        </b-card>
                                    </template>
                                </b-table>
                            </b-tab>
                            <b-tab>
                                <template #title>
                                    <b-icon icon="box-arrow-up-left"></b-icon>
                                    API
                                </template>
                                <div th:align="right">
                                    <b-button v-b-modal.modal-manage-api pill variant="outline-secondary" size="sm" @click="callApiModalInit">V2X 호출</b-button>
                                </div>

                                <b-table
                                        striped
                                        hover
                                        show-empty
                                        :items="app.list.items"
                                        :fields="app.list.fields"
                                >
                                    <template #cell(actions)="row">
                                        <b-button size="sm" @click="setAppValue(row.item, row.index, $event.target)" class="mr-1">
                                            수정
                                        </b-button>
                                        <b-button size="sm" @click="row.toggleDetails">
                                            {{ row.detailsShowing ? '*' : '' }} 정보 조회
                                        </b-button>
                                        <b-button size="sm" @click="deleteApp( row.index )" variant="outline-danger">
                                            삭제
                                        </b-button>
                                    </template>

                                    <template #row-details="row">
                                        <b-card>

                                        </b-card>
                                    </template>
                                </b-table>
                            </b-tab>
                            <b-tab>
                                <template #title>
                                    <b-icon icon="box-arrow-in-down-right"></b-icon>
                                    WEBHOOK
                                    <b-badge pill variant="info">{{webhooksCount}}</b-badge>
                                </template>
                                <div th:align="right">
                                    <b-button variant="outline-danger" size="sm" @click="deleteWebhookAll">전체 삭제</b-button>
                                </div>
                                <b-table
                                        striped
                                        hover
                                        show-empty
                                        :items="webhook.list.items"
                                        :fields="webhook.list.fields"
                                >
                                    <template #cell(resource)="row">
                                        <b-form-textarea
                                                v-model="row.value"
                                                placeholder="Enter something..."
                                                rows="3"
                                                max-rows="3"
                                        ></b-form-textarea>
                                    </template>

                                    <template #cell(actions)="row">
                                        <b-button size="sm" @click="deleteWebhook( row.index )" variant="outline-danger">
                                            삭제
                                        </b-button>
                                    </template>
                                </b-table>
                            </b-tab>
                        </b-tabs>
                    </b-card>
                </div>
            </b-col>
        </b-row>

        <!--footer S-->
        <b-navbar toggleable="lg" type="dark" variant="secondary" fiexd="bottom" sticky="true">
            <b-navbar-brand href="/main">
                <b-icon icon="stoplights"></b-icon>
                ITA
            </b-navbar-brand>
            <b-collapse id="nav-collapse" is-nav>
                <b-navbar-nav class="ml-auto" right>
                    <b-nav-form>
                        <b-form-input size="sm" class="mr-sm-2" placeholder="Search" v-model="searchForm.clientId"></b-form-input>
                        <b-button size="sm" class="my-2 my-sm-0" type="submit">
                            <b-icon icon="search"></b-icon>
                            Search
                        </b-button>
                        <b-button type="button">
                            <b-icon icon="upload" variant="dark"></b-icon>
                        </b-button>
                    </b-nav-form>
                </b-navbar-nav>
            </b-collapse>
        </b-navbar>
        <!--footer E-->

        <!--modal : manage app S-->
        <b-modal id="modal-manage-app" size="lg" :title="app.manage.mode == 'register' ? 'App 등록' : 'App 수정'">
            <div>
                <b-card bg-variant="light">
                    <b-form-group
                            label-cols-lg="3"
                            label="앱의 정보를 입력하세요."
                            label-size="sm"
                            label-class="font-weight-bold pt-0"
                            class="mb-0"
                    >
                        <b-form-group
                                label="* App Name : "
                                label-for="manage-app-name"
                                label-cols-sm="3"
                                label-align-sm="right"
                        >
                            <b-form-input id="manage-app-name"
                                          minlength="3"
                                          maxlength="20"
                                          v-model="app.manage.values.appName"
                                          :state="stateAppName"
                                          trim
                                          required
                            >
                            </b-form-input>
                            <b-form-invalid-feedback :state="stateAppName">
                                App Name must be 3-20 characters long.
                            </b-form-invalid-feedback>
                        </b-form-group>

                        <b-form-group
                                label="* Client Id : "
                                label-for="manage-app-client-id"
                                label-cols-sm="3"
                                label-align-sm="right"
                        >
                            <b-form-input id="manage-app-client-id"
                                          maxlength="22"
                                          minlength="22"
                                          v-model="app.manage.values.clientId"
                                          :state="stateClientId"
                                          trim
                                          required></b-form-input>
                            <b-form-invalid-feedback :state="stateClientId">
                                Client Id must be 22 characters long.
                            </b-form-invalid-feedback>
                        </b-form-group>

                        <b-form-group
                                label="* Secret Key : "
                                label-for="manage-app-secret-key"
                                label-cols-sm="3"
                                label-align-sm="right"
                        >
                            <b-form-input id="manage-app-secret-key"
                                          maxlength="22"
                                          minlength="22"
                                          v-model="app.manage.values.secretKey"
                                          :state="stateSecretKey"
                                          trim
                                          required
                            >
                            </b-form-input>
                            <b-form-invalid-feedback :state="stateSecretKey">
                                Secret Key must be 22 characters long.
                            </b-form-invalid-feedback>
                        </b-form-group>

                        <b-form-group
                                label="Partner Id : "
                                label-for="manage-app-partner-id"
                                label-cols-sm="3"
                                label-align-sm="right"
                        >
                            <b-form-input id="manage-app-partner-id"
                                          maxlength="16"
                                          v-model="app.manage.values.partnerId"
                                          trim
                            >
                            </b-form-input>
                        </b-form-group>

                        <b-form-group
                                label="* 인증 유형 : "
                                label-cols-sm="3"
                                label-align-sm="right"
                                class="mb-0"
                                v-slot="{ ariaDescribedby }"
                        >
                            <b-form-radio-group
                                    class="pt-2"
                                    v-model="app.manage.values.grantType"
                                    :options="app.manage.options.grantType"
                                    :aria-describedby="ariaDescribedby"
                            >
                            </b-form-radio-group>
                        </b-form-group>
                        <b-form-group
                                label="* 토큰 관리 : "
                                label-cols-sm="3"
                                label-align-sm="right"
                                class="mb-0"
                                v-slot="{ ariaDescribedby }"
                        >
                            <b-form-radio-group
                                    class="pt-2"
                                    v-model="app.manage.values.manageToken"
                                    :options="app.manage.options.manageToken"
                                    :aria-describedby="ariaDescribedby"
                            >
                            </b-form-radio-group>
                        </b-form-group>
                        <b-form-group
                                label="* 운영 환경 : "
                                label-cols-sm="3"
                                label-align-sm="right"
                                class="mb-0"
                                v-slot="{ ariaDescribedby }"
                        >
                            <b-form-radio-group
                                    class="pt-2"
                                    v-model="app.manage.values.operationLevel"
                                    :options="app.manage.options.operationLevel"
                                    :aria-describedby="ariaDescribedby"
                            ></b-form-radio-group>
                        </b-form-group>
                    </b-form-group>
                    <div>
                        <b-form-group
                                label="* API 사용권한 : "
                                v-slot="{ ariaDescribedby }"
                        >
                            <b-row>
                                <b-form-input
                                        v-model="scopesStr"
                                        :state="stateScope"
                                        trim
                                        disabled
                                >
                                </b-form-input>
                                <b-form-invalid-feedback :state="stateScope">
                                    Please select at least one scope.
                                </b-form-invalid-feedback>
                            </b-row>
                            <b-row>
                                <b-col>
                                    <b-form-checkbox-group
                                            v-model="app.manage.values.scopes"
                                            :options="app.manage.options.scopes"
                                            :aria-describedby="ariaDescribedby"
                                            switches stacked
                                    ></b-form-checkbox-group>
                                </b-col>
                            </b-row>
                        </b-form-group>
                    </div>
                </b-card>
            </div>

            <template #modal-footer="{ hide }">
                <b-form-invalid-feedback :state="stateAppName && stateClientId && stateSecretKey && stateScope" align="right">
                    앱 정보를 정확히 입력하세요.
                </b-form-invalid-feedback>
                <b-button size="sm" variant="outline-primary" @click="registerApp" :disabled="!(stateAppName && stateClientId && stateSecretKey && stateScope)" v-show="isRegisterApp">
                    등록
                </b-button>
                <b-button size="sm" variant="outline-primary" @click="modifyApp" :disabled="!(stateAppName && stateClientId && stateSecretKey && stateScope)" v-show="!isRegisterApp">
                    수정
                </b-button>
                <b-button size="sm" variant="outline-secondary" @click="hide('forget')">
                    취소
                </b-button>
            </template>
        </b-modal>
        <!--modal : manage app E-->

        <!--modal : manage app S-->
        <b-modal id="modal-manage-api" size="lg" title="API 호출">
            <div>
                <b-card bg-variant="light">

                    <b-form-group label-cols="4" label-cols-lg="2" label-class="font-weight-bold" label-size="sm" label="Mall Id" label-for="input-sm">
                        <b-form-select v-model="api.manage.values.mallId" :options="api.manage.options.mallIds" size="sm" >
                            <template #first>
                                <b-form-select-option :value="''" disabled>-- Please select an option --</b-form-select-option>
                            </template>
                        </b-form-select>
                    </b-form-group>
                    <b-form-group label-cols="4" label-cols-lg="2" label-class="font-weight-bold" label-size="sm" label="HTTP Method" label-for="input-sm">
                        <b-form-radio-group
                                v-model="api.manage.values.methods"
                                :options="api.manage.options.methods"
                        ></b-form-radio-group>
                    </b-form-group>

                    <b-form-group label-cols="4" label-cols-lg="2" label-class="font-weight-bold" label-size="sm" label="Version" label-for="input-sm">
                        <b-form-input v-model="api.manage.values.version" size="sm"></b-form-input>
                    </b-form-group>
                    <b-form-group label-cols="4" label-cols-lg="2" label-class="font-weight-bold" label-size="sm" label="URL" label-for="input-sm">
                        <b-form-input v-model="api.manage.values.url" size="sm"></b-form-input>
                    </b-form-group>
                    <b-form-group label-cols="4" label-cols-lg="2" label-class="font-weight-bold" label-size="sm" label="Request-Body" label-for="input-sm">
                        <b-form-textarea
                                v-model="api.manage.values.requestBody"
                                size="sm"
                                rows="5"
                                placeholder="Request Body"
                        ></b-form-textarea>
                    </b-form-group>

                    <b-button block variant="dark">Call Api</b-button>
                </b-card>

                <b-card bg-variant="light" v-show="'' !== api.manage.values.responseBody">
                    <b-form-group label-cols="4" label-cols-lg="2" label-class="font-weight-bold" label-size="sm" label="Response-Body" label-for="input-sm">
                        <b-form-textarea
                                v-model="api.manage.values.responseBody"
                                size="sm"
                                rows="5"
                                placeholder="Response Body"
                        ></b-form-textarea>
                    </b-form-group>
                </b-card>
            </div>
            <template #modal-footer="{ hide }">
                <b-button size="sm" @click="hide('forget')">
                    Close
                </b-button>
            </template>
            </template>
        </b-modal>
        <!--modal : manage app E-->

    </b-container>
</div>
<input type="text" id="common-input-copy" style="display: none;">

<script th:src="@{/js/main.js}"/>
<script>
    import ita from './main.js';

    export default ita;
</script>
</body>
</html>